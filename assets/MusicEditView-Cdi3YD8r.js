import{_ as B,o as u,c as d,a as i,D as F,r as v,E as I,m as H,t as M,e as b,x as R,d as P,p as T,v as j,U as D,A as C,P as E,b as p,s as _,y as V,F as W,j as N,w as z,g as O,B as k,h as Z}from"./index-D11NS5oJ.js";import{u as q}from"./wavesurfer.esm-C5Vxh-qJ.js";import{_ as G}from"./MyInput-DiFdwflE.js";import{_ as J,a as X}from"./Richbox-CEm5dvjS.js";import{_ as Y}from"./MyCheckbox-BRARZmc_.js";const K={},Q={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"};function $(s,e){return u(),d("svg",Q,e[0]||(e[0]=[i("path",{"fill-rule":"evenodd",d:"M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z","clip-rule":"evenodd"},null,-1)]))}const ee=B(K,[["render",$]]),te={class:"flex flex-col items-center bg-base-300 p-4 rounded-xl shadow shadow-primary"},se={key:0,class:"text-lg font-bold"},ie={class:"mt-2"},le={key:0},ne=["src"],ae=["src"],oe={class:"text-sm py-1 px-1 bg-gray-100/50 text-green-600/80"},re={key:0,class:"progress"},ue=["value"],de={class:"flex gap-6 mt-2"},me=["accept"],ce={__name:"FileUploader",props:F({accept:{default:".png, .jpg"},modelResult:{default:"path"},btnTitle:{type:String,default:"Select Image"},maxW:{type:Number,default:200},title:{type:String,default:"Upload Image"},uploadUrl:{default:""},uploadParams:{default:{}},uploadBtn:{default:!0},imageBox:{default:!0}},{modelValue:{},modelModifiers:{}}),emits:F("change",["update:modelValue"]),setup(s,{emit:e}){const o=s,a=v(null),t=v(null),n=e,m=v(0),h=v(!1),g=v("image"),w=v(!1),U=r=>{w.value=!0;const x=r.target.files[0];if(["jpg","png"].indexOf(y(x.name))>-1){const S=new FileReader;S.readAsDataURL(x),S.onload=L=>{t.value=L.target.result}}n("change",x)},A=()=>{t.value=null,w.value=!1,c.value=""},l=()=>{h.value=!0,D(o.uploadUrl,a.value.files[0],o.uploadParams,r=>{m.value=r,n("progress",r)},r=>{r=JSON.parse(r),h.value=!1,r.ok?(c.value=r[o.modelResult],console.log("model.value",r[o.modelResult],o.modelResult),n("complete",r)):n("error",r.message)},r=>{h.value=!1,n("error",r)})},y=r=>r.split(".").pop(),f=()=>C.server+c.value,c=I(s,"modelValue");return H(c,r=>{r!=null&&r.length&&(g.value=y(r))}),(r,x)=>{var S;return u(),d("div",te,[i("div",null,[s.title?(u(),d("h3",se,M(s.title),1)):b("",!0)]),i("div",ie,[s.imageBox?(u(),d("div",le,[t.value&&!c.value?(u(),d("img",{key:0,style:R(s.maxW?`max-width:${s.maxW}px`:""),class:"mx-auto w-full",src:t.value,alt:""},null,12,ne)):(S=c.value)!=null&&S.length?(u(),d("img",{key:1,style:R(s.maxW?`max-width:${s.maxW}px`:""),class:"mx-auto w-full",src:f(),alt:""},null,12,ae)):(u(),P(ee,{key:2,class:"text-primary w-full"}))])):b("",!0),i("div",null,[i("p",oe,M(c.value),1)]),T(i("div",null,[m.value==0?(u(),d("progress",re)):(u(),d("progress",{key:1,class:"progress progress-primary",value:m.value,max:"100"},null,8,ue))],512),[[j,h.value]])]),i("div",de,[i("input",{readonly:"",accept:o.accept,onChange:U,class:"hidden",ref_key:"input_file",ref:a,type:"file"},null,40,me),c.value?b("",!0):(u(),d("button",{key:0,onClick:x[0]||(x[0]=L=>a.value.click()),class:"btn btn-secondary"},M(o.btnTitle),1)),!c.value&&w.value?(u(),d("button",{key:1,onClick:l,class:"btn btn-primary"},"Upload")):b("",!0),c.value?(u(),d("button",{key:2,onClick:A,class:"btn btn-warning"},"Remove")):b("",!0)])])}}};class he{constructor(e,o=null){this.createMenuElements(),this.elements=e?document.querySelectorAll(e):[document],this.contextmenu_callback=o,this.attachEventListeners(e)}createMenuElements(){this.menu=this.createElement("div",{id:"custom-menu",class:"hi-select-none hi-bg-white dark:hi-bg-slate-800 dark:hi-text-white hi-absolute hi-flex hi-flex-col hi-gap-2 hi-shadow-md hi-shadow-gray-400 dark:hi-shadow-gray-100/50 hi-p-4 hi-z-[1000] hi-rounded-lg hi-w-[90%] hi-max-w-[300px]",style:{display:"none"}}),this.backdrop=this.createElement("div",{class:"hi-fixed hi-inset-0 hi-bg-black/50 hi-z-[999]",style:{display:"none"},onclick:()=>this.hideMenu()}),document.body.append(this.backdrop,this.menu)}createElement(e,o){const a=document.createElement(e);return Object.entries(o||{}).forEach(([t,n])=>{t==="style"?Object.assign(a.style,n):t==="onclick"?a.onclick=n:a.setAttribute(t,n)}),a}attachEventListeners(e){const o=a=>{a.preventDefault();const t=a.target.closest(e);t&&(this.event=a,this.target=t,this.displayMenu(a))};this.elements.forEach(a=>a.addEventListener("contextmenu",o)),document.addEventListener("click",()=>this.hideMenu())}displayMenu(e){this.menu.style.display="block";const{clientX:o,layerY:a}=e,{offsetWidth:t,offsetHeight:n}=this.menu;if(window.innerWidth<=768)this.menu.style.left="50%",this.menu.style.top="50%",this.menu.style.transform="translate(-50%, -50%)",this.backdrop.style.display="block";else{o+t>window.innerWidth?this.menu.style.left=`${window.innerWidth-t}px`:this.menu.style.left=`${Math.min(o)}px`;var m=document.body,h=document.documentElement,g=Math.max(m.offsetHeight,h.clientHeight,h.offsetHeight);this.menu.style.top=`${Math.min(a,g-(n+10))}px`,this.menu.style.transform="none"}typeof this.contextmenu_callback=="function"&&this.contextmenu_callback({...e,target:this.target})}hideMenu(){this.menu.style.display="none",this.backdrop.style.display="none"}onFocus(e){this.addElementListener("focus",e)}onBlur(e){this.addElementListener("blur",e)}addElementListener(e,o){this.elements.forEach(a=>a.addEventListener(e,t=>{const n=t.target.closest(a.tagName);n&&o({...t,target:n})}))}title(e,o="center"){let a=this.menu.querySelector("div[data-title]");if(a)a.style.textAlign=o,a.innerHTML=e;else{a=this.createElement("div",{"data-title":"true",style:{paddingTop:"4px",paddingBottom:"4px",textAlign:o}}),a.innerHTML=e;const t=this.createElement("hr",{style:{opacity:.3}});this.menu.prepend(a,t)}}makeSvgFromData(e,o){const a=decodeURIComponent(e.split(",")[1]),t=new DOMParser().parseFromString(a,"image/svg+xml").documentElement;return t.setAttribute("class",o),t}add(e,o=null){const a=this.createElement("div",{class:"hi-relative hi-flex hi-items-center hi-justify-between hi-gap-2 hover:hi-bg-gray-200 dark:hover:hi-bg-gray-600 hi-duration-100 hi-px-1 hi-py-3 hi-rounded hi-min-w-32"}),t=this.createElement("div");if(t.innerHTML=(e==null?void 0:e.label)||e,a.appendChild(t),e!=null&&e.svgString||e!=null&&e.svgIcon){const n=this.createElement("div",{class:e!=null&&e.svgIcon?"hi-text-black dark:hi-text-white":void 0}),m=e!=null&&e.svgString?this.createElement("div",{innerHTML:e.svgString}):this.makeSvgFromData(e.svgIcon,"hi-size-5");n.appendChild(m),a.appendChild(n)}return o&&(a.onclick=n=>{n.stopPropagation(),this.hideMenu(),o({...this.event,target:this.target})}),this.menu.appendChild(a),[a]}}const pe={components:{MyInput:G,MySelect:J,ImageUploader:ce,MyCheckbox:Y,Richbox:X},setup(){return{route:O(),Post:E}},mounted(){this.route.name=="admin_music_edit"&&this.getInfo(),this.getArtistList(),this.api_token=C.getApiToken()},watch:{"this.segment.start_at"(s){console.log(s)}},data(){return{artist_search:"",audioUrl:"http://127.0.0.1:8000/play",audioLoaded:!1,segments:[],startTime:null,endTime:null,currentText:{text:"",translation:""},currentTime:0,music:{path:""},artists:[],himenu:null,api_token:""}},methods:{getMusic128Url(){if(this.music.name_128)return`${C.server}admin/play-music?artist=${this.music.path}&name=${this.music.name_128}`;if(this.music.name_320)return`${C.server}admin/play-music?artist=${this.music.path}&name=${this.music.name_320}`},addMenuEvent(){this.$nextTick(()=>{console.log("hi menu init"),this.himenu=new he('li[segment="item"]'),this.himenu.add("Delete",s=>{console.log("test");const e=s.target.getAttribute("hi-data");this.segments=this.segments.filter((o,a)=>{if(a!=e)return o})}),this.himenu.onFocus(s=>{s.target.classList.add("bg-gray-300","hover:bg-gray-300")}),this.himenu.onBlur(s=>{s.target.classList.remove("bg-gray-300","hover:bg-gray-300")})})},getInfo(){E("admin/music/info",{id:this.route.params.id}).then(s=>{s.ok&&(Object.assign(this.music,s.music),this.loadAudio())})},getArtistList(){E("admin/artist/list",{}).then(s=>{s.ok&&(this.artists=s.list)})},loadAudio(){this.audioLoaded=!0,this.$nextTick(()=>{q.create({container:"#waveform",waveColor:"#4F4A85",progressColor:"#383351",url:this.getMusic128Url(),cache:"default",mode:"cors",method:"GET",credentials:"same-origin",redirect:"follow",referrer:"client",headers:[{key:"Authorization",value:"my-token"}]}),this.segments=this.music.timeline,this.addMenuEvent()})},setStartTime(){const s=this.$refs.audioPlayer;this.startTime=s.currentTime},setEndTime(){const s=this.$refs.audioPlayer;this.endTime=s.currentTime,s.pause()},addSegment(){if(this.startTime!==null&&this.endTime!==null){const s=(this.endTime-this.startTime).toFixed(2);s>0&&(this.segments.push({start_at:parseFloat(this.startTime.toFixed(2)),duration:parseFloat(s),text:this.currentText.text,translation:this.currentText.translation}),this.startTime=null,this.endTime=null,this.currentText={text:"",translation:""})}this.addMenuEvent()},playSegment(s){const e=this.$refs.audioPlayer;e.currentTime=s,e.play()},updateSegmentHighlight(){var e;const s=(e=this.$refs)==null?void 0:e.audioPlayer;this.currentTime=s==null?void 0:s.currentTime},isActiveSegment(s){return this.currentTime>=s.start_at&&this.currentTime<=s.start_at+s.duration},getArtistByFilter(){var s;return(s=this.artist_search)!=null&&s.length?this.artists.filter(e=>e.name.toLowerCase().indexOf(this.artist_search.toLowerCase())>-1):this.artists},async sendSegments(){E("admin/music/save",{id:this.music.id,title:this.music.title,timeline:this.segments,path:this.music.path,image:this.music.image,name_64:this.music.name_64,name_128:this.music.name_128,name_320:this.music.name_320,published:this.music.published,description:this.music.description}).then(s=>{s.ok&&this.route.name=="admin_music_new"&&this.$router.replace({name:"admin_music_edit",params:{id:s.id}})})},removeSegment(s){this.segments=this.segments.filter((e,o)=>{if(o!=s)return e})}}},ge={class:"max-w-3xl mx-auto p-6 bg-gray-100 rounded-lg shadow-md"},fe={class:""},be={class:"flex justify-evenly w-full items-end"},ye={class:"flex flex-col gap-4"},xe={class:"mt-8"},ve={class:"mb-4"},_e={class:"block text-gray-700 font-medium mb-2"},ke=["value"],we={key:0,class:"mb-6 mt-12"},Se=["src"],Te={class:"flex gap-4 mt-12"},Me={class:"mt-4"},Ee={class:"block text-gray-700 font-medium mb-2"},Ve={class:"block text-gray-700 font-medium mb-2"},Ce={class:"space-y-4"},Ue=["hi-data"],Ae={class:"flex justify-between"},Le=["onClick"],Fe=["onClick"],Re={class:"mt-4"},Be=["onUpdate:modelValue"],Pe=["onUpdate:modelValue"],Ie={class:"text-gray-600 italic"},He={class:"flex justify-between"};function je(s,e,o,a,t,n){const m=k("my-input"),h=k("my-select"),g=k("image-uploader"),w=k("Richbox"),U=k("MyCheckbox"),A=k("RouterLink");return u(),d("div",ge,[i("div",fe,[i("div",be,[i("div",null,[i("div",null,[p(m,{modelValue:t.artist_search,"onUpdate:modelValue":e[0]||(e[0]=l=>t.artist_search=l),title:"search ..."},null,8,["modelValue"]),t.artists.length?(u(),P(h,{key:0,"title-class":"font-bold",modelValue:t.music.path,"onUpdate:modelValue":e[1]||(e[1]=l=>t.music.path=l),options:n.getArtistByFilter(),labels:["Name"],"title-key":"name","value-key":"label",title:"Music Artist"},null,8,["modelValue","options"])):b("",!0)]),p(g,{class:"max-w-64",title:"Upload Music Image","upload-url":"admin/music/upload-music-image","upload-params":{api_token:t.api_token,path:t.music.path},modelValue:t.music.image,"onUpdate:modelValue":e[2]||(e[2]=l=>t.music.image=l),onComplete:n.sendSegments},null,8,["upload-params","modelValue","onComplete"])]),i("div",ye,[p(g,{class:"max-w-64",title:"Upload Music 64","image-box":!1,"upload-url":"admin/music/upload-music","upload-params":{api_token:t.api_token,path:t.music.path},modelValue:t.music.name_64,"onUpdate:modelValue":e[3]||(e[3]=l=>t.music.name_64=l),"model-result":"name",accept:".mp3","btn-title":"Select music",onComplete:n.sendSegments},null,8,["upload-params","modelValue","onComplete"]),p(g,{class:"max-w-64",title:"Upload Music 128","image-box":!1,"upload-url":"admin/music/upload-music","upload-params":{api_token:t.api_token,path:t.music.path},modelValue:t.music.name_128,"onUpdate:modelValue":e[4]||(e[4]=l=>t.music.name_128=l),"model-result":"name","btn-title":"Select music",accept:".mp3",onComplete:n.sendSegments},null,8,["upload-params","modelValue","onComplete"]),p(g,{class:"max-w-64",title:"Upload Music 320","image-box":!1,"upload-url":"admin/music/upload-music","upload-params":{api_token:t.api_token,path:t.music.path},modelValue:t.music.name_320,"onUpdate:modelValue":e[5]||(e[5]=l=>t.music.name_320=l),"model-result":"name",accept:".mp3","btn-title":"Select music",onComplete:n.sendSegments},null,8,["upload-params","modelValue","onComplete"])])]),i("div",xe,[p(m,{modelValue:t.music.title,"onUpdate:modelValue":e[6]||(e[6]=l=>t.music.title=l),title:"Music Title"},null,8,["modelValue"]),p(w,{"model-value":t.music.description,"onUpdate:modelValue":e[7]||(e[7]=l=>t.music.description=l),title:"Music description",class:"mt-10"},null,8,["model-value"]),p(U,{modelValue:t.music.published,"onUpdate:modelValue":e[8]||(e[8]=l=>t.music.published=l),title:"Published",class:"mt-10"},null,8,["modelValue"])])]),e[24]||(e[24]=i("h1",{class:"mt-12 text-2xl font-bold text-center mb-4"},"Audio Editor",-1)),i("div",ve,[i("label",_e,[e[17]||(e[17]=_(" Audio URL: ")),i("input",{value:n.getMusic128Url(),placeholder:"Enter audio URL",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300"},null,8,ke)]),i("button",{onClick:e[9]||(e[9]=(...l)=>n.loadAudio&&n.loadAudio(...l)),class:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"}," Load Audio ")]),t.audioLoaded?(u(),d("div",we,[i("audio",{style:{position:"relative","z-index":"999999"},ref:"audioPlayer",src:n.getMusic128Url(),controls:"",class:"w-full mb-4",onTimeupdate:e[10]||(e[10]=(...l)=>n.updateSegmentHighlight&&n.updateSegmentHighlight(...l))},null,40,Se),e[20]||(e[20]=i("div",{style:{"margin-top":"-100px"}},[i("div",{style:{width:"459px","margin-left":"60px"},id:"waveform"})],-1)),i("div",Te,[i("button",{onClick:e[11]||(e[11]=(...l)=>n.setStartTime&&n.setStartTime(...l)),class:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," Set Start "),i("button",{onClick:e[12]||(e[12]=(...l)=>n.setEndTime&&n.setEndTime(...l)),class:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"}," Set End ")]),i("div",Me,[i("label",Ee,[e[18]||(e[18]=_(" Text: ")),T(i("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>t.currentText.text=l),placeholder:"Enter text",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300"},null,512),[[V,t.currentText.text]])]),i("label",Ve,[e[19]||(e[19]=_(" Translation: ")),T(i("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>t.currentText.translation=l),placeholder:"Enter translation",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300"},null,512),[[V,t.currentText.translation]])]),i("button",{onClick:e[15]||(e[15]=(...l)=>n.addSegment&&n.addSegment(...l)),class:"bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-600"}," Add Segment ")])])):b("",!0),e[25]||(e[25]=i("h2",{class:"text-xl font-semibold mt-6 mb-4"},"Segments",-1)),i("ul",Ce,[(u(!0),d(W,null,N(t.segments,(l,y)=>(u(),d("li",{"hi-data":y,tabindex:"0",segment:"item",key:y,class:Z([n.isActiveSegment(l)?"bg-green-100":"bg-white","p-4 rounded-md shadow-md border border-gray-200 cursor-pointer hover:bg-gray-50"])},[i("div",Ae,[i("button",{onClick:f=>n.playSegment(l.start_at),class:"btn btn-primary btn-outline btn-sm"},"Play",8,Le),i("div",null,[i("button",{onClick:f=>n.removeSegment(y),class:"btn btn-error btn-outline btn-sm"},"Remove",8,Fe)])]),i("div",Re,[i("strong",null,[T(i("input",{type:"number",class:"input w-32 input-primary","onUpdate:modelValue":f=>l.start_at=f},null,8,Be),[[V,l.start_at]]),e[21]||(e[21]=_(" s - ")),T(i("input",{type:"number",class:"input w-32 input-primary","onUpdate:modelValue":f=>l.duration=f},null,8,Pe),[[V,l.duration]]),e[22]||(e[22]=_("s:"))])]),i("p",null,M(l.text),1),i("p",Ie,M(l.translation),1)],10,Ue))),128))]),i("div",He,[i("button",{onClick:e[16]||(e[16]=(...l)=>n.sendSegments&&n.sendSegments(...l)),class:"mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600"}," Send to Server "),p(A,{to:{name:"admin_music_list"},class:"mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600"},{default:z(()=>e[23]||(e[23]=[_(" Show list ")])),_:1})])])}const Ze=B(pe,[["render",je]]);export{Ze as default};
