import{m as A,u as B,o as r,c as d,a as i,n as M,t as m,f as c,w as k,H as z,F as H,l as I,_ as P,r as v,s as D,B as R,e as j,x as N,U as O,A as U,P as C,d as b,z as _,C as V,j as K,i as q,E}from"./index-BqBDIYu4.js";import{u as Z}from"./wavesurfer.esm-C5Vxh-qJ.js";import{_ as G}from"./MyInput-zXNFnaEf.js";const J={class:"form-control w-full max-w-xs"},X={class:"label"},Y={disabled:"",value:null},Q=["value"],$={class:"label"},ee={key:0,class:"label-text-alt"},te={key:1,class:"label-text-alt"},se={__name:"MySelect",props:A({valueKey:{default:"value"},titleKey:{default:"title"},titleClass:{default:""},selectClass:{default:""},options:{type:Array,default:()=>[],required:!0},placeholder:{type:String,default:"Select an option"},title:{type:String,default:""},topAltText:{type:String,default:""},bottomLeftAltText:{type:String,default:""},bottomRightAltText:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,o=B(t,"modelValue");return(n,s)=>(r(),d("label",J,[i("div",X,[e.title?(r(),d("span",{key:0,class:M([e.titleClass,"label-text"])},m(e.title),3)):c("",!0),t.topAltText?(r(),d("span",{key:1,class:M([e.titleClass,"label-text-alt"])},m(t.topAltText),3)):c("",!0)]),k(i("select",{class:M([e.selectClass,"select select-bordered"]),"onUpdate:modelValue":s[0]||(s[0]=l=>o.value=l),onChange:s[1]||(s[1]=l=>n.$emit("update:modelValue",l.target.value))},[i("option",Y,m(t.placeholder),1),(r(!0),d(H,null,I(t.options,l=>(r(),d("option",{key:l[e.valueKey],value:l[e.valueKey]},m(l[e.titleKey]),9,Q))),128))],34),[[z,o.value]]),i("div",$,[t.bottomLeftAltText?(r(),d("span",ee,m(t.bottomLeftAltText),1)):c("",!0),t.bottomRightAltText?(r(),d("span",te,m(t.bottomRightAltText),1)):c("",!0)])]))}},le={},ie={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"};function ne(t,e){return r(),d("svg",ie,e[0]||(e[0]=[i("path",{"fill-rule":"evenodd",d:"M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0 0 21 18v-1.94l-2.69-2.689a1.5 1.5 0 0 0-2.12 0l-.88.879.97.97a.75.75 0 1 1-1.06 1.06l-5.16-5.159a1.5 1.5 0 0 0-2.12 0L3 16.061Zm10.125-7.81a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z","clip-rule":"evenodd"},null,-1)]))}const ae=P(le,[["render",ne]]),oe={class:"flex flex-col items-center bg-base-300 p-4 rounded-xl shadow shadow-primary"},re={key:0,class:"text-lg font-bold"},ue={class:"mt-2"},de={key:0},me=["src"],ce=["src"],he={class:"text-sm py-1 px-1 bg-gray-100/50 text-green-600/80"},pe={key:0,class:"progress"},ge=["value"],fe={class:"flex gap-6 mt-2"},ye=["accept"],be={__name:"FileUploader",props:A({accept:{default:".png, .jpg"},modelResult:{default:"path"},btnTitle:{type:String,default:"Select Image"},maxW:{type:Number,default:200},title:{type:String,default:"Upload Image"},uploadUrl:{default:""},uploadParams:{default:{}},uploadBtn:{default:!0},imageBox:{default:!0}},{modelValue:{},modelModifiers:{}}),emits:A("change",["update:modelValue"]),setup(t,{emit:e}){const o=t,n=v(null),s=v(null),l=e,h=v(0),g=v(!1),f=v("image"),w=v(!1),a=u=>{w.value=!0;const x=u.target.files[0];if(["jpg","png"].indexOf(L(x.name))>-1){const T=new FileReader;T.readAsDataURL(x),T.onload=F=>{s.value=F.target.result}}l("change",x)},S=()=>{s.value=null,w.value=!1,p.value=""},y=()=>{g.value=!0,O(o.uploadUrl,n.value.files[0],o.uploadParams,u=>{h.value=u,l("progress",u)},u=>{u=JSON.parse(u),g.value=!1,u.ok?(p.value=u[o.modelResult],console.log("model.value",u[o.modelResult],o.modelResult),l("complete",u)):l("error",u.message)},u=>{g.value=!1,l("error",u)})},L=u=>u.split(".").pop(),W=()=>U.server+p.value,p=B(t,"modelValue");return D(p,u=>{u!=null&&u.length&&(f.value=L(u))}),(u,x)=>{var T;return r(),d("div",oe,[i("div",null,[t.title?(r(),d("h3",re,m(t.title),1)):c("",!0)]),i("div",ue,[t.imageBox?(r(),d("div",de,[s.value&&!p.value?(r(),d("img",{key:0,style:R(t.maxW?`max-width:${t.maxW}px`:""),class:"mx-auto w-full",src:s.value,alt:""},null,12,me)):(T=p.value)!=null&&T.length?(r(),d("img",{key:1,style:R(t.maxW?`max-width:${t.maxW}px`:""),class:"mx-auto w-full",src:W(),alt:""},null,12,ce)):(r(),j(ae,{key:2,class:"text-primary w-full"}))])):c("",!0),i("div",null,[i("p",he,m(p.value),1)]),k(i("div",null,[h.value==0?(r(),d("progress",pe)):(r(),d("progress",{key:1,class:"progress progress-primary",value:h.value,max:"100"},null,8,ge))],512),[[N,g.value]])]),i("div",fe,[i("input",{readonly:"",accept:o.accept,onChange:a,class:"hidden",ref_key:"input_file",ref:n,type:"file"},null,40,ye),p.value?c("",!0):(r(),d("button",{key:0,onClick:x[0]||(x[0]=F=>n.value.click()),class:"btn btn-secondary"},m(o.btnTitle),1)),!p.value&&w.value?(r(),d("button",{key:1,onClick:y,class:"btn btn-primary"},"Upload")):c("",!0),p.value?(r(),d("button",{key:2,onClick:S,class:"btn btn-warning"},"Remove")):c("",!0)])])}}};class xe{constructor(e,o=null){this.createMenuElements(),this.elements=e?document.querySelectorAll(e):[document],this.contextmenu_callback=o,this.attachEventListeners(e)}createMenuElements(){this.menu=this.createElement("div",{id:"custom-menu",class:"hi-select-none hi-bg-white dark:hi-bg-slate-800 dark:hi-text-white hi-absolute hi-flex hi-flex-col hi-gap-2 hi-shadow-md hi-shadow-gray-400 dark:hi-shadow-gray-100/50 hi-p-4 hi-z-[1000] hi-rounded-lg hi-w-[90%] hi-max-w-[300px]",style:{display:"none"}}),this.backdrop=this.createElement("div",{class:"hi-fixed hi-inset-0 hi-bg-black/50 hi-z-[999]",style:{display:"none"},onclick:()=>this.hideMenu()}),document.body.append(this.backdrop,this.menu)}createElement(e,o){const n=document.createElement(e);return Object.entries(o||{}).forEach(([s,l])=>{s==="style"?Object.assign(n.style,l):s==="onclick"?n.onclick=l:n.setAttribute(s,l)}),n}attachEventListeners(e){const o=n=>{n.preventDefault();const s=n.target.closest(e);s&&(this.event=n,this.target=s,this.displayMenu(n))};this.elements.forEach(n=>n.addEventListener("contextmenu",o)),document.addEventListener("click",()=>this.hideMenu())}displayMenu(e){this.menu.style.display="block";const{clientX:o,layerY:n}=e,{offsetWidth:s,offsetHeight:l}=this.menu;if(window.innerWidth<=768)this.menu.style.left="50%",this.menu.style.top="50%",this.menu.style.transform="translate(-50%, -50%)",this.backdrop.style.display="block";else{o+s>window.innerWidth?this.menu.style.left=`${window.innerWidth-s}px`:this.menu.style.left=`${Math.min(o)}px`;var h=document.body,g=document.documentElement,f=Math.max(h.offsetHeight,g.clientHeight,g.offsetHeight);this.menu.style.top=`${Math.min(n,f-(l+10))}px`,this.menu.style.transform="none"}typeof this.contextmenu_callback=="function"&&this.contextmenu_callback({...e,target:this.target})}hideMenu(){this.menu.style.display="none",this.backdrop.style.display="none"}onFocus(e){this.addElementListener("focus",e)}onBlur(e){this.addElementListener("blur",e)}addElementListener(e,o){this.elements.forEach(n=>n.addEventListener(e,s=>{const l=s.target.closest(n.tagName);l&&o({...s,target:l})}))}title(e,o="center"){let n=this.menu.querySelector("div[data-title]");if(n)n.style.textAlign=o,n.innerHTML=e;else{n=this.createElement("div",{"data-title":"true",style:{paddingTop:"4px",paddingBottom:"4px",textAlign:o}}),n.innerHTML=e;const s=this.createElement("hr",{style:{opacity:.3}});this.menu.prepend(n,s)}}makeSvgFromData(e,o){const n=decodeURIComponent(e.split(",")[1]),s=new DOMParser().parseFromString(n,"image/svg+xml").documentElement;return s.setAttribute("class",o),s}add(e,o=null){const n=this.createElement("div",{class:"hi-relative hi-flex hi-items-center hi-justify-between hi-gap-2 hover:hi-bg-gray-200 dark:hover:hi-bg-gray-600 hi-duration-100 hi-px-1 hi-py-3 hi-rounded hi-min-w-32"}),s=this.createElement("div");if(s.innerHTML=(e==null?void 0:e.label)||e,n.appendChild(s),e!=null&&e.svgString||e!=null&&e.svgIcon){const l=this.createElement("div",{class:e!=null&&e.svgIcon?"hi-text-black dark:hi-text-white":void 0}),h=e!=null&&e.svgString?this.createElement("div",{innerHTML:e.svgString}):this.makeSvgFromData(e.svgIcon,"hi-size-5");l.appendChild(h),n.appendChild(l)}return o&&(n.onclick=l=>{l.stopPropagation(),this.hideMenu(),o({...this.event,target:this.target})}),this.menu.appendChild(n),[n]}}const ve={components:{MyInput:G,MySelect:se,ImageUploader:be},setup(){return{route:q(),Post:C}},mounted(){this.route.name=="admin_music_edit"&&this.getInfo(),this.getArtistList(),this.api_token=U.getApiToken()},watch:{"this.segment.start_at"(t){console.log(t)}},data(){return{artist_search:"",audioUrl:"http://127.0.0.1:8000/play",audioLoaded:!1,segments:[],startTime:null,endTime:null,currentText:{text:"",translation:""},currentTime:0,music:{path:""},artists:[],himenu:null,api_token:""}},methods:{getMusic128Url(){return`${U.server}admin/play-music?artist=${this.music.path}&name=${this.music.name_128}`},addMenuEvent(){this.$nextTick(()=>{console.log("hi menu init"),this.himenu=new xe('li[segment="item"]'),this.himenu.add("Delete",t=>{console.log("test");const e=t.target.getAttribute("hi-data");this.segments=this.segments.filter((o,n)=>{if(n!=e)return o})}),this.himenu.onFocus(t=>{t.target.classList.add("bg-gray-300","hover:bg-gray-300")}),this.himenu.onBlur(t=>{t.target.classList.remove("bg-gray-300","hover:bg-gray-300")})})},getInfo(){C("admin/music/info",{id:this.route.params.id}).then(t=>{t.ok&&(Object.assign(this.music,t.music),this.loadAudio())})},getArtistList(){C("admin/artist/list",{}).then(t=>{t.ok&&(this.artists=t.list)})},loadAudio(){this.audioLoaded=!0,this.$nextTick(()=>{Z.create({container:"#waveform",waveColor:"#4F4A85",progressColor:"#383351",url:this.getMusic128Url(),cache:"default",mode:"cors",method:"GET",credentials:"same-origin",redirect:"follow",referrer:"client",headers:[{key:"Authorization",value:"my-token"}]}),this.segments=this.music.timeline,this.addMenuEvent()})},setStartTime(){const t=this.$refs.audioPlayer;this.startTime=t.currentTime},setEndTime(){const t=this.$refs.audioPlayer;this.endTime=t.currentTime,t.pause()},addSegment(){if(this.startTime!==null&&this.endTime!==null){const t=(this.endTime-this.startTime).toFixed(2);t>0&&(this.segments.push({start_at:parseFloat(this.startTime.toFixed(2)),duration:parseFloat(t),text:this.currentText.text,translation:this.currentText.translation}),this.startTime=null,this.endTime=null,this.currentText={text:"",translation:""})}this.addMenuEvent()},playSegment(t){const e=this.$refs.audioPlayer;e.currentTime=t,e.play()},updateSegmentHighlight(){var e;const t=(e=this.$refs)==null?void 0:e.audioPlayer;this.currentTime=t==null?void 0:t.currentTime},isActiveSegment(t){return this.currentTime>=t.start_at&&this.currentTime<=t.start_at+t.duration},getArtistByFilter(){var t;return(t=this.artist_search)!=null&&t.length?this.artists.filter(e=>e.name.toLowerCase().indexOf(this.artist_search.toLowerCase())>-1):this.artists},async sendSegments(){C("admin/music/save",{id:this.music.id,title:this.music.title,timeline:this.segments,path:this.music.path,image:this.music.image,name_64:this.music.name_64,name_128:this.music.name_128,name_320:this.music.name_320}).then(t=>{t.ok&&this.route.name=="admin_music_new"&&this.$router.replace({name:"admin_music_edit",params:{id:t.id}})})},removeSegment(t){this.segments=this.segments.filter((e,o)=>{if(o!=t)return e})}}},_e={class:"max-w-3xl mx-auto p-6 bg-gray-100 rounded-lg shadow-md"},ke={class:""},we={class:"flex justify-evenly w-full items-end"},Se={class:"flex flex-col gap-4"},Te={class:"mt-8"},Ce={class:"mb-4"},Ve={class:"block text-gray-700 font-medium mb-2"},Ee=["value"],Me={key:0,class:"mb-6 mt-12"},Ae=["src"],Ue={class:"flex gap-4 mt-12"},Le={class:"mt-4"},Fe={class:"block text-gray-700 font-medium mb-2"},Re={class:"block text-gray-700 font-medium mb-2"},Be={class:"space-y-4"},He=["hi-data"],Ie={class:"flex justify-between"},Pe=["onClick"],je=["onClick"],We={class:"mt-4"},ze=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Ne={class:"text-gray-600 italic"},Oe={class:"flex justify-between"};function Ke(t,e,o,n,s,l){const h=E("my-input"),g=E("my-select"),f=E("image-uploader"),w=E("RouterLink");return r(),d("div",_e,[i("div",ke,[i("div",we,[i("div",null,[i("div",null,[b(h,{modelValue:s.artist_search,"onUpdate:modelValue":e[0]||(e[0]=a=>s.artist_search=a),title:"search ..."},null,8,["modelValue"]),s.artists.length?(r(),j(g,{key:0,"title-class":"font-bold",modelValue:s.music.path,"onUpdate:modelValue":e[1]||(e[1]=a=>s.music.path=a),options:l.getArtistByFilter(),labels:["Name"],"title-key":"name","value-key":"label",title:"Music Artist"},null,8,["modelValue","options"])):c("",!0)]),b(f,{class:"max-w-64",title:"Upload Music Image","upload-url":"admin/music/upload-music-image","upload-params":{api_token:s.api_token,path:s.music.path},modelValue:s.music.image,"onUpdate:modelValue":e[2]||(e[2]=a=>s.music.image=a),onComplete:l.sendSegments},null,8,["upload-params","modelValue","onComplete"])]),i("div",Se,[b(f,{class:"max-w-64",title:"Upload Music 64","image-box":!1,"upload-url":"admin/music/upload-music","upload-params":{api_token:s.api_token,path:s.music.path},modelValue:s.music.name_64,"onUpdate:modelValue":e[3]||(e[3]=a=>s.music.name_64=a),"model-result":"name",accept:".mp3","btn-title":"Select music",onComplete:l.sendSegments},null,8,["upload-params","modelValue","onComplete"]),b(f,{class:"max-w-64",title:"Upload Music 128","image-box":!1,"upload-url":"admin/music/upload-music","upload-params":{api_token:s.api_token,path:s.music.path},modelValue:s.music.name_128,"onUpdate:modelValue":e[4]||(e[4]=a=>s.music.name_128=a),"model-result":"name","btn-title":"Select music",accept:".mp3",onComplete:l.sendSegments},null,8,["upload-params","modelValue","onComplete"]),b(f,{class:"max-w-64",title:"Upload Music 320","image-box":!1,"upload-url":"admin/music/upload-music","upload-params":{api_token:s.api_token,path:s.music.path},modelValue:s.music.name_320,"onUpdate:modelValue":e[5]||(e[5]=a=>s.music.name_320=a),"model-result":"name",accept:".mp3","btn-title":"Select music",onComplete:l.sendSegments},null,8,["upload-params","modelValue","onComplete"])])]),i("div",Te,[b(h,{modelValue:s.music.title,"onUpdate:modelValue":e[6]||(e[6]=a=>s.music.title=a),title:"Music Title"},null,8,["modelValue"])])]),e[22]||(e[22]=i("h1",{class:"mt-12 text-2xl font-bold text-center mb-4"},"Audio Editor",-1)),i("div",Ce,[i("label",Ve,[e[15]||(e[15]=_(" Audio URL: ")),i("input",{value:l.getMusic128Url(),placeholder:"Enter audio URL",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300"},null,8,Ee)]),i("button",{onClick:e[7]||(e[7]=(...a)=>l.loadAudio&&l.loadAudio(...a)),class:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"}," Load Audio ")]),s.audioLoaded?(r(),d("div",Me,[i("audio",{style:{position:"relative","z-index":"999999"},ref:"audioPlayer",src:l.getMusic128Url(),controls:"",class:"w-full mb-4",onTimeupdate:e[8]||(e[8]=(...a)=>l.updateSegmentHighlight&&l.updateSegmentHighlight(...a))},null,40,Ae),e[18]||(e[18]=i("div",{style:{"margin-top":"-100px"}},[i("div",{style:{width:"459px","margin-left":"60px"},id:"waveform"})],-1)),i("div",Ue,[i("button",{onClick:e[9]||(e[9]=(...a)=>l.setStartTime&&l.setStartTime(...a)),class:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"}," Set Start "),i("button",{onClick:e[10]||(e[10]=(...a)=>l.setEndTime&&l.setEndTime(...a)),class:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"}," Set End ")]),i("div",Le,[i("label",Fe,[e[16]||(e[16]=_(" Text: ")),k(i("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>s.currentText.text=a),placeholder:"Enter text",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300"},null,512),[[V,s.currentText.text]])]),i("label",Re,[e[17]||(e[17]=_(" Translation: ")),k(i("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>s.currentText.translation=a),placeholder:"Enter translation",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300"},null,512),[[V,s.currentText.translation]])]),i("button",{onClick:e[13]||(e[13]=(...a)=>l.addSegment&&l.addSegment(...a)),class:"bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-600"}," Add Segment ")])])):c("",!0),e[23]||(e[23]=i("h2",{class:"text-xl font-semibold mt-6 mb-4"},"Segments",-1)),i("ul",Be,[(r(!0),d(H,null,I(s.segments,(a,S)=>(r(),d("li",{"hi-data":S,tabindex:"0",segment:"item",key:S,class:M([l.isActiveSegment(a)?"bg-green-100":"bg-white","p-4 rounded-md shadow-md border border-gray-200 cursor-pointer hover:bg-gray-50"])},[i("div",Ie,[i("button",{onClick:y=>l.playSegment(a.start_at),class:"btn btn-primary btn-outline btn-sm"},"Play",8,Pe),i("div",null,[i("button",{onClick:y=>l.removeSegment(S),class:"btn btn-error btn-outline btn-sm"},"Remove",8,je)])]),i("div",We,[i("strong",null,[k(i("input",{type:"number",class:"input w-32 input-primary","onUpdate:modelValue":y=>a.start_at=y},null,8,ze),[[V,a.start_at]]),e[19]||(e[19]=_(" s - ")),k(i("input",{type:"number",class:"input w-32 input-primary","onUpdate:modelValue":y=>a.duration=y},null,8,De),[[V,a.duration]]),e[20]||(e[20]=_("s:"))])]),i("p",null,m(a.text),1),i("p",Ne,m(a.translation),1)],10,He))),128))]),i("div",Oe,[i("button",{onClick:e[14]||(e[14]=(...a)=>l.sendSegments&&l.sendSegments(...a)),class:"mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600"}," Send to Server "),b(w,{to:{name:"admin_music_list"},class:"mt-6 bg-blue-500 text-white px-6 py-2 rounded-md hover:bg-blue-600"},{default:K(()=>e[21]||(e[21]=[_(" Show list ")])),_:1})])])}const Je=P(ve,[["render",Ke]]);export{Je as default};
